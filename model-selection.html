
<!DOCTYPE html>


<html lang="en" data-content_root="./" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>16. Model Selection &amp; Evaluation &#8212; Probabilistic Foundations of Machine Learning (CS345)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/css/course_schedule.css?v=244d4a68" />
    <link rel="stylesheet" type="text/css" href="_static/css/main.css?v=19873a65" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'model-selection';</script>
    <link rel="canonical" href="https://mogu-lab.github.io/cs345/model-selection.html" />
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="17. The Ethics of Predictive Models in Sociotechnical Systems" href="ethics-of-predictive-models.html" />
    <link rel="prev" title="15. Neural Networks" href="neural-networks.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Probabilistic Foundations of Machine Learning (CS345) - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Probabilistic Foundations of Machine Learning (CS345) - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Probabilistic Foundations of ML
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Syllabus</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="goals-and-expectations.html">Goals and Expectations</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies.html">Course Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="skills-check.html">Skills Check</a></li>
<li class="toctree-l1"><a class="reference internal" href="schedule.html">Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="oh.html">Office Hours</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.google.com/document/d/1qukk9gJaKuDjHYCPRQ7mwlWUcrGfGDb6uQ2HdDQM2Z4/edit?usp=sharing" rel="noreferrer" target="_blank">Found a Typo?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="hw-instructions.html">How to Download/Run/Submit</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepnote.com/workspace/cs-345-310c9b73-880a-47f6-bf25-ce4447f74107/project/Homework-1-Vectorization-in-Jax-c708e3de-1cae-4339-983a-6537242ff685?utm_content=c708e3de-1cae-4339-983a-6537242ff685" rel="noreferrer" target="_blank">Homework 1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepnote.com/workspace/CS-345-310c9b73-880a-47f6-bf25-ce4447f74107/project/Homework-2-Directed-Graphical-Models-3e5555d9-b5ea-4956-8918-6a2312219447/notebook/90a08ad4fbec4b78be01fb8be7e3d897" rel="noreferrer" target="_blank">Homework 2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepnote.com/workspace/cs-345-310c9b73-880a-47f6-bf25-ce4447f74107/project/Homework-3-Frequentist-Learning-6ed8e371-3576-48c2-8b2d-2560ffc7373a?utm_content=6ed8e371-3576-48c2-8b2d-2560ffc7373a" rel="noreferrer" target="_blank">Homework 3</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepnote.com/workspace/cs-345-310c9b73-880a-47f6-bf25-ce4447f74107/project/Homework-4-Predictive-Models-f7594194-db85-4784-9805-fe49570a0a9f?utm_content=f7594194-db85-4784-9805-fe49570a0a9f" rel="noreferrer" target="_blank">Homework 4</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepnote.com/workspace/cs-345-310c9b73-880a-47f6-bf25-ce4447f74107/project/Homework-5-Generative-Models-0d20529f-bb70-431a-bb54-0632f8f91b82?utm_content=0d20529f-bb70-431a-bb54-0632f8f91b82" rel="noreferrer" target="_blank">Homework 5</a></li>
<li class="toctree-l1"><a class="reference external" href="https://deepnote.com/workspace/cs-345-310c9b73-880a-47f6-bf25-ce4447f74107/project/Homework-6-Bayesian-Models-3eea7ffa-b4f0-46de-b252-15fcebfec2f1?utm_content=3eea7ffa-b4f0-46de-b252-15fcebfec2f1" rel="noreferrer" target="_blank">Homework 6</a></li>
<li class="toctree-l1"><a class="reference external" href="https://drive.google.com/drive/folders/1JP8d7OAeiw-Ff7cUhtMUBXRg-y2qkUMt?usp=sharing" rel="noreferrer" target="_blank">Homework 7</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Probabilistic ML: What is it? Why use it?</a></li>
<li class="toctree-l1"><a class="reference internal" href="vectorization-basics.html">2. Introduction to Vectorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="vectorization-advanced.html">3. Advanced Vectorization</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Directed Graphical Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="probability-discrete.html">4. Probability (Discrete)</a></li>
<li class="toctree-l1"><a class="reference internal" href="probability-conditional.html">5. Conditional Probability (Discrete)</a></li>
<li class="toctree-l1"><a class="reference internal" href="probability-joint.html">6. Joint Probability (Discrete)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ethics-of-data.html">7. The Ethics of Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Frequentist Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="mle-theory.html">8. Maximum Likelihood: Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="mle-code.html">9. Maximum Likelihood: Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html">10. Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="probability-continuous.html">11. Probability (Continuous)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ethics-of-learning-from-data.html">12. The Ethics of Learning from Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Predictive Models</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="regression.html">13. Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="classification.html">14. Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="neural-networks.html">15. Neural Networks</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">16. Model Selection &amp; Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ethics-of-predictive-models.html">17. The Ethics of Predictive Models in Sociotechnical Systems</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Generative Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="gmms.html">18. Gaussian Mixture Models (Clustering)</a></li>
<li class="toctree-l1"><a class="reference internal" href="factor-analysis.html">19. Factor Analysis (Dimensionality Reduction)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ethics-of-generative-models.html">20. The Ethics of Generative Models in Sociotechnical Systems</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Bayesian Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="priors-and-posteriors.html">21. Priors and Posteriors</a></li>
<li class="toctree-l1"><a class="reference internal" href="posterior-predictives.html">22. Posterior Predictives</a></li>
<li class="toctree-l1"><a class="reference internal" href="ethics-of-uncertainty-and-interpretability.html">23. The Ethics of Uncertainty and Interpretability in Human-AI Systems</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Synthesis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ethics-of-ml.html">24. The Ethics of Machine Learning: A View from History</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/model-selection.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Model Selection & Evaluation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preventing-over-and-under-fitting">16.1. Preventing Over- and Under-fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#log-likelihood">16.2. Log-Likelihood</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics-for-regression">16.3. Metrics for Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics-for-classification">16.4. Metrics for Classification</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="model-selection-evaluation">
<h1><span class="section-number">16. </span>Model Selection &amp; Evaluation<a class="headerlink" href="#model-selection-evaluation" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import some helper functions (please ignore this!)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">probabilistic_foundations_of_ml</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pfml</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Context:</strong> At this point, we have a general framework for developing probabilistic models, as well as one way of fitting them to data, MLE. We’ve then instantiated this framework to develop two types of predictive models—regression and classification. We further learned how to build in expressivity using tools from deep learning—namely, neural networks—into these models. Are we finally ready to apply these models to real-life tasks?</p>
<p>Unfortunately, there’s one key piece we’re still missing: so far, we’ve only used 1- and 2-dimensional input data and 1-dimensional output data. While in principle, we already have the tools to implement predictive models for higher dimensional data, we don’t yet have the tools to <em>evaluate</em> them. We’ve purposefully worked with lower dimensional data because it is easy to visualize, and therefore easy to qualitatively evaluate. But as data becomes higher dimensional, it’s much more difficult to get intuition using visualizations. As a result, we will have to rely on <em>metrics</em>.</p>
<p><strong>Challenge:</strong> There are many ways of measuring model performance. Which metrics should we use? What are the pros and cons of each metric? We will answer these questions here. Even though our motivation for developing evaluation metrics is our inability to visualize high-dimensional data, we will in fact focus on low-dimensional data, again. This is because we need to gain intuition about each metric we introduce.</p>
<p><strong>Outline:</strong></p>
<ul class="simple">
<li><p>What’s underfitting/overfitting? How do we prevent it?</p></li>
<li><p>Introduce log-likelihood</p></li>
<li><p>Introduce metrics specific to regression</p></li>
<li><p>Introduce metrics specific to classification</p></li>
</ul>
<p><strong>Data.</strong> You’ve started a collaboration with doctors from IHH’s Center for Rare Disorders. The doctors are interested in better understanding Antenna Inflammation, in which a being’s antennas sporadically inflame for weeks at a time. This causes them to malfunction and is quite painful. Because the disease is so rare, it’s been difficult to gather enough information to develop a treatment. Currently, the only known treatment is to expose the inflamed antennas to high-energy space beams. While these beams do not cure the disease, they do alleviate the pain. Doctors are interested in better understanding what beam intensity to use; they suspect that a low-intensity beam might not help much, but too high of an intensity might also contribute to pain. They have collected data for you to analyze. Let’s take a look:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import a bunch of libraries we&#39;ll be using below</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pylab</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.random</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jrandom</span>

<span class="c1"># Load the data into a pandas dataframe</span>
<span class="n">csv_fname</span> <span class="o">=</span> <span class="s1">&#39;data/IHH-CRD-train.csv&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_fname</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Patient ID&#39;</span><span class="p">)</span>

<span class="c1"># Print a random sample of patients, just to see what&#39;s in the data</span>
<span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intensity</th>
      <th>Comfort</th>
    </tr>
    <tr>
      <th>Patient ID</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>45</th>
      <td>0.400600</td>
      <td>0.964841</td>
    </tr>
    <tr>
      <th>59</th>
      <td>0.396205</td>
      <td>1.056692</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.258072</td>
      <td>0.857226</td>
    </tr>
    <tr>
      <th>50</th>
      <td>0.207297</td>
      <td>0.725486</td>
    </tr>
    <tr>
      <th>92</th>
      <td>0.502688</td>
      <td>1.024173</td>
    </tr>
    <tr>
      <th>27</th>
      <td>0.128112</td>
      <td>0.425399</td>
    </tr>
    <tr>
      <th>131</th>
      <td>0.379528</td>
      <td>1.328371</td>
    </tr>
    <tr>
      <th>137</th>
      <td>0.331724</td>
      <td>0.774225</td>
    </tr>
    <tr>
      <th>122</th>
      <td>0.748351</td>
      <td>1.289176</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.073868</td>
      <td>0.264080</td>
    </tr>
    <tr>
      <th>111</th>
      <td>0.627877</td>
      <td>1.186544</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.555007</td>
      <td>1.332022</td>
    </tr>
    <tr>
      <th>63</th>
      <td>0.374981</td>
      <td>0.883373</td>
    </tr>
    <tr>
      <th>76</th>
      <td>0.602109</td>
      <td>1.202155</td>
    </tr>
    <tr>
      <th>123</th>
      <td>0.704252</td>
      <td>1.399664</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Models.</strong> In addition to the data the doctors have collected, they’ve gone ahead and fit some models to the data. They haven’t told you much about the modeling choices they made, but still want your help selecting which model best to use. Let’s load up the models:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="n">load_all_regression_models_of_comfort_vs_intensity</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of models loaded:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">models</span> <span class="o">=</span> <span class="n">load_all_regression_models_of_comfort_vs_intensity</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of models loaded:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">))</span>

<span class="nn">File ~/work/cs345/cs345/utils.py:154,</span> in <span class="ni">load_all_regression_models_of_comfort_vs_intensity</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span> <span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/regression_model_eval_metrics_*.dill&#39;</span><span class="p">)):</span>
<span class="ne">--&gt; </span><span class="mi">154</span>     <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfml</span><span class="o">.</span><span class="n">load_trained_numpyro_model</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span> <span class="k">return</span> <span class="n">models</span>

<span class="nn">File ~/work/cs345/cs345/probabilistic_foundations_of_ml.py:203,</span> in <span class="ni">load_trained_numpyro_model</span><span class="nt">(fname)</span>
<span class="g g-Whitespace">    </span><span class="mi">193</span><span class="w"> </span><span class="sd">&#39;&#39;&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">194</span><span class="sd"> A function to load a numpyro model from a file</span>
<span class="g g-Whitespace">    </span><span class="mi">195</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">199</span><span class="sd"> Returns: the model</span>
<span class="g g-Whitespace">    </span><span class="mi">200</span><span class="sd"> &#39;&#39;&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">202</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>        
<span class="ne">--&gt; </span><span class="mi">203</span>     <span class="n">r</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">205</span> <span class="k">return</span> <span class="n">H</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">])</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/dill/_dill.py:289,</span> in <span class="ni">load</span><span class="nt">(file, ignore, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">283</span> <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">284</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">285</span><span class="sd">     Unpickle an object from a file.</span>
<span class="g g-Whitespace">    </span><span class="mi">286</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">287</span><span class="sd">     See :func:`loads` for keyword arguments.</span>
<span class="g g-Whitespace">    </span><span class="mi">288</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">289</span>     <span class="k">return</span> <span class="n">Unpickler</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="n">ignore</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/dill/_dill.py:444,</span> in <span class="ni">Unpickler.load</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">443</span> <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1">#NOTE: if settings change, need to update attributes</span>
<span class="ne">--&gt; </span><span class="mi">444</span>     <span class="n">obj</span> <span class="o">=</span> <span class="n">StockUnpickler</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">445</span>     <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_main_module</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;__main__&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">446</span>         <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">447</span>             <span class="c1"># point obj class to main</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/dill/_dill.py:434,</span> in <span class="ni">Unpickler.find_class</span><span class="nt">(self, module, name)</span>
<span class="g g-Whitespace">    </span><span class="mi">432</span>     <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="c1">#XXX: special case: NoneType missing</span>
<span class="g g-Whitespace">    </span><span class="mi">433</span> <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;dill.dill&#39;</span><span class="p">:</span> <span class="n">module</span> <span class="o">=</span> <span class="s1">&#39;dill._dill&#39;</span>
<span class="ne">--&gt; </span><span class="mi">434</span> <span class="k">return</span> <span class="n">StockUnpickler</span><span class="o">.</span><span class="n">find_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;jaxlib.xla_extension&#39;
</pre></div>
</div>
</div>
</div>
<p>We’ve created a helper function for you to visualize all of the models. Let’s have a look:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_all_regression_models_of_comfort_vs_intensity</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">models</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/07a24e6770d6593f55ae843f9af352ac0e6ee93bf07742e3ac2a520ece4203b2.png" src="_images/07a24e6770d6593f55ae843f9af352ac0e6ee93bf07742e3ac2a520ece4203b2.png" />
</div>
</div>
<section id="preventing-over-and-under-fitting">
<h2><span class="section-number">16.1. </span>Preventing Over- and Under-fitting<a class="headerlink" href="#preventing-over-and-under-fitting" title="Link to this heading">#</a></h2>
<p><strong>Decomposition into Signal vs. Noise.</strong> In probabilistic models, we often term one part of the model the “trend” or the “signal,” and we term the rest “noise” or “observation error.” For example, recall that in regression, our trend is captured by a function of the inputs, <span class="math notranslate nohighlight">\(\mu(\cdot; W)\)</span>, around which we assume a Gaussian observation error. Similarly, in the classification model we introduced, our trend is captured by a function of the inputs, <span class="math notranslate nohighlight">\(\rho(\cdot; W)\)</span>, which computes the probability of belonging to class 1 (as opposed to class 0). We then sample from a Bernoulli distribution with that probability—this represents the “noise” or “observation error.” When fitting a probabilistic model, we’re always at risk of learning models that mix up what’s signal vs. what’s noise. This can happen in two ways:</p>
<ul class="simple">
<li><p><strong>Overfitting:</strong> When the “signal” part of the model memorizes the “noise” part, and as a result, interpolates poorly. By <em>interpolation</em>, we mean, how well the model fits data points <em>near</em> our training data.</p></li>
<li><p><strong>Underfitting:</strong> When a model doesn’t capture enough of the “signal” in the data (assuming it’s noise), and as a result, interpolates poorly.</p></li>
</ul>
<p>Let’s illustrate what overfitting and underfitting each look like, in both classification and regression:</p>
<figure class="align-center" id="model-fitting-illustration">
<a class="reference internal image-reference" href="_images/model-fitting-illustration.png"><img alt="_images/model-fitting-illustration.png" src="_images/model-fitting-illustration.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 16.1 </span><span class="caption-text">Illustration of overfitting and underfitting, adapted from <a class="reference external" href="https://i.pinimg.com/originals/72/e2/22/72e222c1542539754df1d914cb671bd7.png" rel="noreferrer" target="_blank">this image</a>.</span><a class="headerlink" href="#model-fitting-illustration" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p><strong>Preventing Inappropriate Decomposition into Signal vs. Noise.</strong> How can we tell if a model overfit or underfit? Well, looking at the definition above, we said a model over/under-fitts if it <em>interpolates</em> poorly. This means that, to determine if a model over/under-fit, we should check its fit <em>on data it has not seen yet</em>—specifically, on data that’s similar to our training data.</p>
<p>But where can we get such extra data points? Oftentimes, it’s hard to collect additional data. For example, at the IHH, data collection is expensive; it’s funded by large government grants and requires approval of an <a class="reference external" href="https://en.wikipedia.org/wiki/Institutional_review_board" rel="noreferrer" target="_blank">Institutional Review Board (IRB)</a> to ensure data collection and analysis is ethical. As a result, we often cannot collect additional data. Instead, however, we can <em>split our data into parts</em>—one part for training and one part for validating the model’s interpolation. Specifically, after fitting the model on the training data, we compare the model’s fit on the training data with its fit on the validation data:</p>
<ul class="simple">
<li><p>If the fit on the training data is better than that on the validation data, we <em>overfit</em>.</p></li>
<li><p>If the fit on neither the training data nor the validation data is good, we <em>underfit.</em></p></li>
<li><p>If the fit on both the training and validation data is comparably good, we fit just right!</p></li>
</ul>
<p>The bottom row of <a class="reference internal" href="#model-fitting-illustration"><span class="std std-numref">Fig. 16.1</span></a> above shows the loss function evaluated on both the training data and the validation set over iterations (or “epochs”) of gradient descent.</p>
<p><strong>Reporting Model Performance.</strong> In practice, we often aren’t just interested in the fitted model—we also want to report some <em>metric</em> to quantify how well it fits. To accomodate this need, we split the data into three parts: a training set, a validation set, and a test set.</p>
<ul class="simple">
<li><p>We fit the model to the <em>training</em> data.</p></li>
<li><p>We use the <em>validation</em> set to determine over/under-fitting (by comparing the fit on the validation vs. training data, as described above).</p></li>
<li><p>Finally, we report the model’s performance on the <em>test</em> set.</p></li>
</ul>
<p>Often, we use <span class="math notranslate nohighlight">\(70\%\)</span> of the data for the training, <span class="math notranslate nohighlight">\(20\%\)</span> for validation, and <span class="math notranslate nohighlight">\(10\%\)</span> for testing.</p>
<p><strong>But which metric should we use?</strong> That’s a million-dollar question! We will next present several common metrics for evaluating model performance numerically. As you will see, model performance is multi-faceted—there’s more to consider than just how well the model fits. For example, is the model fair? and will the model be understandable to a human? If we have multiple factors to consider, how can we possibly design a metric that gives us a single ranking of models from best to worst? The answer is: we can’t. We will have to use multiple metrics to evaluate our models. At times, these metrics will present us with contradictory information, and we will have to determine what to do.</p>
</section>
<section id="log-likelihood">
<h2><span class="section-number">16.2. </span>Log-Likelihood<a class="headerlink" href="#log-likelihood" title="Link to this heading">#</a></h2>
<p><strong>A General Purpose Metric.</strong> Since so far, we fit our models by finding parameters that maximize the data log-likelihood (MLE). Can we also use log-likelihood as an evaluation metric? If we trust this metric for <em>fitting</em> our model, surely we should trust it for <em>evaluation</em> as well. And what’s nice about log-likelihood is that, unlike some of the other metrics we’ll introduce next, it’s not model-specific. We can evaluate the log-likelihood of <em>any</em> probabilistic model.</p>
<p><strong>Log-Likelihood as an Evaluation Metric.</strong> Recall that the data log-likelihood is,</p>
<div class="amsmath math notranslate nohighlight" id="equation-f68dc233-eaf4-4702-8659-6d7a2a5d55f8">
<span class="eqno">(16.1)<a class="headerlink" href="#equation-f68dc233-eaf4-4702-8659-6d7a2a5d55f8" title="Permalink to this equation">#</a></span>\[\begin{align}
\log p(\mathcal{D}; \theta) &amp;= \sum\limits_{n=1}^N \log p(\mathcal{D}_n; \theta),
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{D}\)</span> is our entire data set of <span class="math notranslate nohighlight">\(N\)</span> observations, each <span class="math notranslate nohighlight">\(\mathcal{D}_n\)</span> is an observation, and <span class="math notranslate nohighlight">\(\theta\)</span> is the model parameters. However, notice that in this definition, the data log-likelihood grows as <span class="math notranslate nohighlight">\(N\)</span> increases due to the sum. This means that, if our train, validation and test sets each have a different number of points, we cannot compare their log-likelihoods directly. To fix this problem, we instead compute the <em>average</em> log-likelihood (this is just the above equation divided by <span class="math notranslate nohighlight">\(N\)</span>):</p>
<div class="amsmath math notranslate nohighlight" id="equation-f6894e12-6dd3-4fd8-9f69-047f467ef776">
<span class="eqno">(16.2)<a class="headerlink" href="#equation-f6894e12-6dd3-4fd8-9f69-047f467ef776" title="Permalink to this equation">#</a></span>\[\begin{align}
\text{Avg. Log-Likelihood} = \frac{1}{N} \sum\limits_{n=1}^N \log p(\mathcal{D}_n; \theta).
\end{align}\]</div>
<div class="admonition-exercise-getting-intuition-for-log-likelihood admonition">
<p class="admonition-title">Exercise: Getting Intuition for Log-Likelihood</p>
<p><strong>Part 1:</strong> Looking at the plots of the models above, rank them from what you’d consider best to worst. How did you arrive at this ranking? Please relate your answer to the broader context of the problem.</p>
<p><strong>Part 2:</strong> For each model, evaluate the average log-likelihood on the training, validation, and test set. Do this by,</p>
<ul>
<li><p>Loading in the list of models (using the function we provided above). Each model in the list has the following signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Expects x to be of shape (N, 1)</span>
    <span class="c1"># Expects y to be of shape (N, 1)</span>
    <span class="k">pass</span> <span class="c1"># already implemented</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">N</span></code> is the number of points, <code class="docutils literal notranslate"><span class="pre">x</span></code> are the inputs, and <code class="docutils literal notranslate"><span class="pre">y</span></code> are the outputs.</p>
</li>
<li><p>Loading the training, validation, and test data sets from <code class="docutils literal notranslate"><span class="pre">data/IHH-CRD-train.csv</span></code>, <code class="docutils literal notranslate"><span class="pre">data/IHH-CRD-val.csv</span></code>, and <code class="docutils literal notranslate"><span class="pre">data/IHH-CRD-test.csv</span></code>.</p></li>
<li><p>Finally, compute the average log-likelihood. Please use the helper function we created, <code class="docutils literal notranslate"><span class="pre">pfml.joint_data_log_likelihood(model,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code>, where <code class="docutils literal notranslate"><span class="pre">*args,</span> <span class="pre">**kwargs</span></code> capture all arguments your model takes in: <code class="docutils literal notranslate"><span class="pre">N,</span> <span class="pre">x,</span> <span class="pre">y=None</span></code>. Note that our helper function computes the <em>joint data</em> log-likelihood, not the average log-likelihood.</p></li>
</ul>
<p><strong>Part 3:</strong> Rank the models using log-likelihood on the training set and report log-likelihood test set. Did this method succeed in ranking the best-fitting model on top? Next, rank the models using validation set and report the test log-likelihood. Did this method successfully rank the best-fitting model on top?</p>
<p><strong>Part 4:</strong> How did the ranking you got from using the validation set compare with your initial ranking from part (1)? What does log-likelihood penalize models for?</p>
</div>
<p><strong>Human-meaningful Notions of Model-fit.</strong> So log-likelihood seems to work well when <em>comparing</em> models; given a collection of trained models, we can use log-likelihood on the validation set to select a model that is likely to fit the test set well. However, suppose we’re given a single model—how do we know if this model is good? For example, if our model’s log-likelihood is <span class="math notranslate nohighlight">\(0.123\)</span>, is that good? is that bad? The <em>units</em> of log-likelihood hold little meaning to us. Because of this, log-likelihood is difficult to interpret on its own, leading us to search for other metrics we can more easily interpret.</p>
</section>
<section id="metrics-for-regression">
<h2><span class="section-number">16.3. </span>Metrics for Regression<a class="headerlink" href="#metrics-for-regression" title="Link to this heading">#</a></h2>
<p><strong>Mean Squared Error (MSE).</strong> Since log-likelihood is hard to interpret on its own, we will now introduce another metric, MSE, specific to regression. This metric can be used together with log-likelihood to paint a clearer picture of model fit. This is, of course, not the only evaluation metric for regression, but it’s a common one, so we’ll focus on it here. For 1-dimensional output data, the MSE is defined as follows:</p>
<div class="amsmath math notranslate nohighlight" id="equation-a0d72a2d-8988-4c5f-aeca-4ecc8e37d4b5">
<span class="eqno">(16.3)<a class="headerlink" href="#equation-a0d72a2d-8988-4c5f-aeca-4ecc8e37d4b5" title="Permalink to this equation">#</a></span>\[\begin{align}
\text{MSE} &amp;= \frac{1}{N} \sum\limits_{n=1}^N (\underbrace{y_n - \widehat{y}_n}_{\text{error}})^2,
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(y_n\)</span> is an observation and <span class="math notranslate nohighlight">\(\widehat{y}_n\)</span> the model’s prediction. As the name suggests, we compute the error between our model’s prediction and the observation, square it, and average. The MSE can be thought of as a measure of “spread” (or, in statistical lingo, the <em>variance</em>) of the data around the model’s prediction. Hopefully, in contrast to log-likelihood, it’s a little easier to understand, since we may have domain knowledge of what error, <span class="math notranslate nohighlight">\(y_n - \widehat{y}_n\)</span>, is considered high/low.</p>
<p>But for a probabilistic model, what is the model’s “prediction”? In a probabilistic regression model, we have a <em>distribution</em> of outputs given inputs, <span class="math notranslate nohighlight">\(p_{Y | X}\)</span>, and a distribution is <em>not</em> a single prediction. Because of this, we have to summarize the conditional distribution using a single value. Here, we will use the mean (which also happens to be the mode—or the most likely value of <span class="math notranslate nohighlight">\(y\)</span>). For our regression model, the mean of the distribion is the “trend,” so</p>
<div class="amsmath math notranslate nohighlight" id="equation-af4585bf-8f83-47f4-86a2-5f46ed09b340">
<span class="eqno">(16.4)<a class="headerlink" href="#equation-af4585bf-8f83-47f4-86a2-5f46ed09b340" title="Permalink to this equation">#</a></span>\[\begin{align}
\hat{y}_n &amp;= \mu(x_n; W^\text{MLE}).
\end{align}\]</div>
<div class="admonition-exercise-implement-and-use-mse admonition">
<p class="admonition-title">Exercise: Implement and Use MSE</p>
<p><strong>Part 1:</strong> Write a function to compute the MSE. The models are set up such that calling <code class="docutils literal notranslate"><span class="pre">pfml.sample_generative_process</span></code> will return a Python dictionary with key <code class="docutils literal notranslate"><span class="pre">mu</span></code>, containing <span class="math notranslate nohighlight">\(\mu(x_n; W^\text{MLE})\)</span>.</p>
<p><strong>Part 2:</strong> For each model, evaluate the MSE on the training, validation, and test set.</p>
<p><strong>Part 3:</strong> Rank the models using validation MSE and report the test MSE. Does this ranking disagree with the log-likelihood ranking? If so, where? <em>Hint: look at the observation noise.</em></p>
<p><strong>Part 4:</strong> Are there any other factors we should have considered in our evaluation of the models? Let’s load the training, validation, and test data sets from <code class="docutils literal notranslate"><span class="pre">data/IHH-CRD-train-augmented.csv</span></code>, <code class="docutils literal notranslate"><span class="pre">data/IHH-CRD-val-augmented.csv</span></code>, and <code class="docutils literal notranslate"><span class="pre">data/IHH-CRD-test-augmented.csv</span></code>. These data sets are the same as before, just with a previously omitted feature: race. As it turns out, the intervention (the space beam), was only tested on one of these races and not the other. Create a scatter plot of the training data using color to distinguish between the two races.</p>
<ul class="simple">
<li><p>What’s different about the trend for the two races? What’s the same?</p></li>
<li><p>How do you think this will affect the model’s predictive performance on each of the two races? Why?</p></li>
</ul>
<p><strong>Part 5:</strong> Re-compute the log-likelihood of each model on each of these data sets, this time evaluating it separately for each race. For which race does the model perform better on? Why?</p>
</div>
</section>
<section id="metrics-for-classification">
<h2><span class="section-number">16.4. </span>Metrics for Classification<a class="headerlink" href="#metrics-for-classification" title="Link to this heading">#</a></h2>
<p><strong>Accuracy.</strong> Since log-likelihood is hard to interpret on its own, we will now introduce another metric, accuracy, that’s specific to classification. Simply put, accuracy is the fraction of predictions the model got correct:</p>
<div class="amsmath math notranslate nohighlight" id="equation-4bab24cf-23d6-47e8-ba42-009d7f08f96c">
<span class="eqno">(16.5)<a class="headerlink" href="#equation-4bab24cf-23d6-47e8-ba42-009d7f08f96c" title="Permalink to this equation">#</a></span>\[\begin{align}
\text{Accuracy} &amp;= \frac{1}{N} \underbrace{\sum\limits_{n=1}^N \mathbb{I}(y_n = \widehat{y}_n),}_{\text{count correct predictions}}
\end{align}\]</div>
<p>where, as before, <span class="math notranslate nohighlight">\(\widehat{y}_n\)</span> is the model’s prediction, and <span class="math notranslate nohighlight">\(\mathbb{I}(\cdot)\)</span> is an indicator function—a function that evaluates to <span class="math notranslate nohighlight">\(1\)</span> when the condition inside is true and <span class="math notranslate nohighlight">\(0\)</span> otherwise. The sum over the indicators counts the number of correct predictions. When divided by <span class="math notranslate nohighlight">\(N\)</span>, we get the fraction of correct predictions.</p>
<p>Just like before, a probabilistic model does not make “predictions;” it models a full distribution over outputs given inputs. We, again, have to choose how to summarize this distribution using a single value. Remember that in our classification model, <span class="math notranslate nohighlight">\(\rho(x_n)\)</span> outputted the probability of <span class="math notranslate nohighlight">\(x_n\)</span> belonging to class 1 (vs. class 0). To turn this into a prediction, we will threshold it: if <span class="math notranslate nohighlight">\(\rho(x_n) \geq 0.5\)</span>, we’ll say <span class="math notranslate nohighlight">\(x_n\)</span> belongs to class 1—otherwise, it belongs to class 0. We can formalize this using an indicator function:</p>
<div class="amsmath math notranslate nohighlight" id="equation-d1cb4a8f-3317-4bd1-99f6-9269e735e5a1">
<span class="eqno">(16.6)<a class="headerlink" href="#equation-d1cb4a8f-3317-4bd1-99f6-9269e735e5a1" title="Permalink to this equation">#</a></span>\[\begin{align}
\widehat{y}_n &amp;= \mathbb{I}(\rho(x_n) \geq 0.5)
\end{align}\]</div>
<div class="admonition-exercise-the-shortcomings-of-accuracy admonition">
<p class="admonition-title">Exercise: The Shortcomings of Accuracy</p>
<p><strong>Context.</strong> Since the disease is incredibly rare, occurring only in <span class="math notranslate nohighlight">\(0.1\%\)</span> of the population, doctors don’t yet know what are its causes. The doctors have managed to acquire a large fund to collect data about a large swath of the population, ranging from genetic factors to environmental factors (demographics, occupation, diet, physiology, etc.). They just finished collecting the data and have run a preliminary analysis to determine which factors contribute most.</p>
<p><strong>Challenge.</strong> Even though their model is <span class="math notranslate nohighlight">\(99.9\%\)</span> accurate, they have found that none of the factors seem to matter to the model—how is this possible? They recruited you to help understand what’s going on with their model.</p>
<p><strong>Part 1:</strong> You decided to inspect the parameters of the model. In the model, <span class="math notranslate nohighlight">\(1\)</span> represents having the disease and <span class="math notranslate nohighlight">\(0\)</span> represents no disease. Lucky for you, the doctors used a linear classification model (so interpreting it is possible):</p>
<div class="amsmath math notranslate nohighlight" id="equation-c40e9073-3505-46d1-a904-a237f37ff433">
<span class="eqno">(16.7)<a class="headerlink" href="#equation-c40e9073-3505-46d1-a904-a237f37ff433" title="Permalink to this equation">#</a></span>\[\begin{align}
p_{Y | X}(y_n | x_n; \theta) &amp;= \mathrm{Ber}\left( \rho(x_n; \theta) \right) 
\end{align}\]</div>
<p>where</p>
<div class="amsmath math notranslate nohighlight" id="equation-d9d6a35b-5a27-43f9-8914-1bcb7eaf81fa">
<span class="eqno">(16.8)<a class="headerlink" href="#equation-d9d6a35b-5a27-43f9-8914-1bcb7eaf81fa" title="Permalink to this equation">#</a></span>\[\begin{align}
\rho(x_n; \theta) &amp;= \mathrm{sigmoid}\left( \theta^{(0)} + \sum\limits_{d=1}^{D_x} \theta^{(d)} \cdot x_n^{(d)} \right),
\end{align}\]</div>
<p>where the <span class="math notranslate nohighlight">\((d)\)</span>-superscript notation represents the <span class="math notranslate nohighlight">\(d\)</span>th dimension, and <span class="math notranslate nohighlight">\(D_x\)</span> is the dimensionality of the inputs <span class="math notranslate nohighlight">\(x_n\)</span>. When inspecting the parameters, you found that,</p>
<div class="amsmath math notranslate nohighlight" id="equation-54d766b1-3ff1-4621-842a-d2e3f61e3a58">
<span class="eqno">(16.9)<a class="headerlink" href="#equation-54d766b1-3ff1-4621-842a-d2e3f61e3a58" title="Permalink to this equation">#</a></span>\[\begin{align}
\theta &amp;= [\underbrace{-6.90675}_{\theta^{(0)}}, \underbrace{0.0, 0.0, \dots, 0.0}_{\theta^{(1)}, \dots, \theta^{(D_x)}}].
\end{align}\]</div>
<p>Looking at the parameters, <span class="math notranslate nohighlight">\(\theta\)</span>, which dimensions of the input matter most?</p>
<p><strong>Part 2:</strong> How can such a model achieve such high accuracy?</p>
<p><strong>Part 3:</strong> Suppose the IHH were to deploy this model as a screening tool for beings coming into the IHH’s emergency room. The model would be used to identify beings at high risk of Antenna Infection for early treatment. What problems may arise?</p>
</div>
<p><strong>Confusion Matrices.</strong> Although accuracy is easy to evaluate and understand, it has some major shortcomings, as you’ve shown in the exercise above. Confusion matrices aim to address this issue by looking at the ways in which the model makes mistakes when it’s incorrect. Why are they called “confusion” matrices? Maybe to alleviate our confusion? Unclear. Anyways, we define a confusion matrix as follows:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p><strong>Predicted: Disease</strong></p></th>
<th class="head"><p><strong>Predicted: No Disease</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Actual: Disease</strong></p></td>
<td><p><em>True Positives:</em> The number of patients with the disease who were correctly classified as having the disease.</p></td>
<td><p><em>False Negatives:</em> The number of patients with the disease who were incorrectly classified as not having the disease.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Actual: No Disease</strong></p></td>
<td><p><em>False Positives:</em> The number of patients without the disease who were incorrectly classified as having the disease.</p></td>
<td><p><em>True Negatives:</em> The number of patients without the disease who were correctly classified as having no disease.</p></td>
</tr>
</tbody>
</table>
</div>
<p>As you can see, a confusion matrix presents a breakdown of the model’s correct and incorrect predictions.</p>
<div class="admonition-exercise-understanding-confusion-matrices admonition">
<p class="admonition-title">Exercise: Understanding Confusion Matrices</p>
<p><strong>Part 1:</strong> Write down the confusion matrix for the classifier presented to you by the doctors in the previous problems (in terms of the number of patients in the data, <span class="math notranslate nohighlight">\(N\)</span>).</p>
<p><strong>Part 2:</strong> To try to fix the problem, the doctors trained two more classifiers on their data set. As per your suggestion, they are now computing the confusion matrices for both (instead of looking at accuracy alone):</p>
<ul>
<li><p>Model 1:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\text{Accuracy} = 90.0\%, \quad \text{Confusion Matrix} = \begin{bmatrix} 200 &amp; 800 \\ 99000 &amp; 900000 \\ \end{bmatrix}.
\end{align*}\]</div>
</li>
<li><p>Model 2:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\text{Accuracy} = 80.0\%, \quad \text{Confusion Matrix} = \begin{bmatrix} 900 &amp; 100 \\ 199000 &amp; 800000 \\ \end{bmatrix}.
\end{align*}  \]</div>
</li>
</ul>
<p>For the screening tool described in the previous problem, which model would you prefer? Why?</p>
<p><strong>Part 3:</strong> Make up a scenario in which you would prefer the model you didn’t choose? What differentiates your scenario from the one about the screening tool?</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="neural-networks.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">15. </span>Neural Networks</p>
      </div>
    </a>
    <a class="right-next"
       href="ethics-of-predictive-models.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">17. </span>The Ethics of Predictive Models in Sociotechnical Systems</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preventing-over-and-under-fitting">16.1. Preventing Over- and Under-fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#log-likelihood">16.2. Log-Likelihood</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics-for-regression">16.3. Metrics for Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics-for-classification">16.4. Metrics for Classification</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <footer>
  <div class="flex-shrink-0 container">
    <div class="row align-items-center">
      <div class="col-8">

        <p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><span property="dct:title">Probabilistic Foundations of Machine Learning</span> by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://yanivyacoby.github.io/" target="_blank">Yaniv Yacoby</a> is licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" alt=""></a></p>

      </div>      
      <div class="col-4">
        <img src="_static/img/wc-logo-blue.png" alt="Wellesley College Logo" class="only-light" style="max-width: 120px; float: right; display: block;"/>
        <img src="_static/img/wc-logo-white.png" alt="Wellesley College Logo" class="only-dark" style="max-width: 120px; float: right; display: block;"/>
      </div>
    </div>    
  </div>  
</footer>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>